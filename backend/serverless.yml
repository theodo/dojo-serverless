service:
  name: dojo-serverless-backend

package:
  exclude:
    - .git/**
    - .gitignore

plugins:
  - serverless-webpack

provider:
  name: aws
  runtime: nodejs10.x
  region: eu-west-1
  stage: dev
  profile: dojo-serverless
  iamRoleStatements:
    - Effect: Allow
      Action:
        - dynamodb:Query
        - dynamodb:Scan
        - dynamodb:GetItem
        - dynamodb:PutItem
        - dynamodb:UpdateItem
        - dynamodb:DeleteItem
      Resource:
        - 'Fn::GetAtt': [DojoServerlessTable, Arn]
  usagePlan:
    quota:
      limit: 5000
      offset: 2
      period: MONTH
    throttle:
      burstLimit: 200
      rateLimit: 100

functions:
  hello:
    handler: hello.main
    events:
      - http:
          method: get
          path: hello
          cors: true
  createVirus:
    handler: src/handlers/virus/create.main
    events:
      - http:
          method: post
          path: virus
          cors: true
  getVirus:
    handler: src/handlers/virus/get.main
    events:
      - http:
          method: get
          path: virus
          cors: true
  killVirus:
    handler: src/handlers/virus/kill.main
    events:
      - http:
          method: delete
          path: virus/{id}
          cors: true

resources:
  - ${file(resources/api-gateway-errors.yml)}
  - ${file(resources/dynamodb.yml)}
